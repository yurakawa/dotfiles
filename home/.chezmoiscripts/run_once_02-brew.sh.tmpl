{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash

set -e

echo "üç∫ Installing Homebrew packages..."

# Ensure Homebrew is in PATH
if [[ -f /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

if ! command -v brew &> /dev/null; then
    echo "‚ùå Homebrew is not installed. Please run 'chezmoi apply' again."
    exit 1
fi

# Install from Brewfile in repository root (parent of chezmoi source directory)
BREWFILE="{{ .chezmoi.sourceDir }}/../Brewfile"
if [[ -f "$BREWFILE" ]]; then
    brew bundle --file="$BREWFILE" || echo "‚ö†Ô∏è  Some packages failed to install"
else
    echo "‚ö†Ô∏è  Brewfile not found at $BREWFILE. Skipping brew bundle."
fi

echo "‚úÖ Homebrew packages installed!"
{{- end }}
